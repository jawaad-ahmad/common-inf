#!/bin/sh
# {{ ansible_banner }}

make_resolv_conf_with_outside_dns() {
   logger 'pre-up.d: Generating /etc/resolv.conf with Cloudfare name servers'
   cat << END_OF_FILE > /etc/resolv.conf
## Generated by NetworkManager
#search home
#nameserver 192.168.1.1
#nameserver 74.40.74.40

# Reference: https://www.techradar.com/news/best-dns-server

#---
# OpenDNS
#---
#
# o One of the biggest names in public DNS
# o Plenty of benefits: high speeds, 100% uptime, phishing sites blocked by
#   default, optional parental controls-type web filtering to block websites
#   by content type, along with free email support if anything goes wrong

#nameserver 208.67.222.222
#nameserver 208.67.220.220


#---
# Cloudfare
#---
#
# o focused much more on the fundamentals: performance, fastest public DNS
#   service based on independent testing
# o privacy - promises it won't use your browsing data to serve ads, commits
#   that it will never write the querying IP address (yours) to disk, logs
#   deleted within 24 hours, annual third-party audit with public report
# o no ad-blocking, no attempt to monitor what you can/cannot access
# o content filtering for malware blocking with 1.1.1.2/1.0.0.2 services
# o content filtering for adult content blocking with 1.1.1.3/1.0.0.3 services

#nameserver 1.1.1.1
#nameserver 1.0.0.1


#---
# Google Public DNS
#---
#
# o privacy not bad - logs the full IP address information of the querying
#   device for around 24 to 48 hours for troubleshooting and diagnostic
#   purposes; permanent logs drop any PII and reduce location details to the
#   city level; and all but a small random sample of these are deleted after
#   two weeks

nameserver 8.8.8.8
nameserver 8.8.4.4


#---
# Comodo Secure DNS
#---
#
# o extra layer of web filtering
# o strong focus on safety - blocks phishing sites, and warns if you try to
#   visit sites with malware, spyware, even parked domains that might overload
#   you with advertising (pop-ups, pop-unders and more)
# o claims its service is smarter than average - detecting attempts to visit
#   parked or 'not in use' domains and automatically forwarding you to where
#   you really want to go
# o DNSPerf's Comodo stats are less impressive - average query time ~72ms

#nameserver 8.26.56.26
#nameserver 8.20.247.20


#---
# Quad9
#---
#
# o block malicious domains by collecting intelligence from 18+ 'threat
#   intelligence providers'
# o DNSPerf currently rates it seven out of ten for average worldwide query
#   times, lagging behind Cloudflare and OpenDNS, but effortlessly outpacing
#   contenders like Comodo
# o Quad9 is in eighth place for North American queries

#nameserver 9.9.9.9
#nameserver 149.112.112.112


#---
# Verisign DNS
#---
#
# o three features they deem the most important: stability, security, and
#   privacy
# o definitely delivers especially for security and stability
# o assures you that your public DNS data will not be sold to third parties
# o performance wasn't that great, still it's decent
# o DNSPerf.com ranks the service at the eleventh place worldwide

#nameserver 64.6.64.6
#nameserver 64.6.65.6


END_OF_FILE
}

make_resolv_conf_with_lan_dns() {
   logger 'pre-up.d: Generating /etc/resolv.conf with router name server'
   cat << END_OF_FILE > /etc/resolv.conf
nameserver ${router_ip_address}
END_OF_FILE
}

make_resolv_conf() {
   logger 'pre-up.d: Getting wireless network name'

   ssid="$(/sbin/iwconfig wlan0 | grep --only-matching 'ESSID\:\"[^"]*\"' | cut --delimiter=\" --fields=2)"

   if [ -n "${ssid}" ]; then
      logger "pre-up.d: Wireless network SSID=${ssid}"

      if [ "${ssid}" = "Bamboo1" ]; then
         router_ip_address=192.168.131.1
         make_resolv_conf_with_lan_dns
      elif [ "${ssid}" = "Bamboo2" ]; then
         router_ip_address=192.168.121.1
         make_resolv_conf_with_lan_dns
      else
         make_resolv_conf_with_outside_dns
      fi
   else
      make_resolv_conf_with_outside_dns
   fi
}

make_resolv_conf
